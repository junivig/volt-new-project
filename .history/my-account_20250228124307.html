<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account</title>
    <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <!-- Bootstrap CSS (already included most likely) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<!-- Bootstrap JS (this is required for modals to work) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
  <script src="assets/js/constant.js"></script>
  <!-- Add Axios CDN -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        .top-section {
            height: 40vh;
            background-image: url('assets/img/bg-mountain.png');
            background-size: cover;
            background-color: rgba(53, 155, 65, 0.7); /* Light green with 50% transparency */
            background-blend-mode: overlay;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        .modal { display: none; position: fixed; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); }
    .modal-content { background: #fff; padding: 20px; margin: 10% auto; width: 50%; }
    .close { float: right; font-size: 28px; cursor: pointer; }
        .back-button {
            position: absolute; 
            left: 30px;
            top: 10vh;
            color: white;
            font-size: 1rem;
            text-decoration: underline;
        }
        .tabs-container {
            position: relative;
            justify-content: center;
            display: flex;
            justify-content: space-evenly;
            margin-top: -8vh;
            z-index: 10;
        }
        .tab-button.active {
            width: 180px;
            height: 120px;
            background-color: #F2F2F2;
            border: 2px solid #518F2B;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .tab-button {
            width: 180px;
            height: 120px;
            background-color: #F2F2F2;
            border: 2px solid #F2F2F2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .tab-button i {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .btn-light-green {
            background-color: #BCD531 !important;
            color: white !important;
            font-size: small;
            padding: 5px 40px;
            border-radius: 40px;
        }
        .btn-add-new {
            background-color: #BCD531 !important;
            color: white !important;
            font-size: small;
            padding: 10px 40px;
            border-radius: 40px;
        }
        .btn-light-gray {
            background-color: #F2F2F2 !important;
            color: #BCD531 !important;
            font-size: small;
            padding: 5px 40px;
            border-radius: 40px;
            margin-right: 10px;
        }
        .form-control {
            padding: 10px 20px;
            color: grey !important;
        }
        .privacy-text {
            color: black;
            font-size: large;
            margin-bottom: 10px;
            text-align: center;
        }
        .icon-size {
            width: 35px;
            height: 35px;
            margin-bottom: 5px;
        }
        .table th {
            font-weight: bold;
        }
        .order-id {
            color: green;
            text-decoration: none;
        }
        .my-account-heading
        {
            color: #fff;
        }
        .btn-view {
            background-color: #c4d82e;
            color: white;
            border-radius: 20px;
            border: none;
            padding: 5px 15px;
        }
    </style>
</head>
<body class="d-flex flex-column">
    <header id="header" class="header ">
        <div class="container-fluid  top-header">
          <div class="container-xl">
              <div class="row align-items-center">
                  <div class="col-md-8 d-flex align-items-center">
                    <nav id="navmenu" class="navmenu">
                      <ul>
                    <li class="">
                      <img src="assets/img/location-icon.png" alt="Location Icon" class="icon-right">
                      <span class="top-header-text">Address, Fox 99 Roving St, Big City PKU</span>
                  </li>
                    <li class="">
                      <img src="assets/img/email-icon.png" alt="Email Icon" class="icon-right">
                      <span class="top-header-text">hello@awesomesite.com</span>
                  </li>
                  <li class="">
                    <img src="assets/img/phone-icon.png" alt="Phone Icon" class="icon-right">
                    <span class="top-header-text">+123-234-1234</span>
                </li>       
                      </ul>
                    </nav>          
                  </div>
                  <div class="col-md-4 text-end">
                      <a href="auth.html" >Register</a>
                      <a href="auth.html">Login</a>
                      <a href="my-account.html">My Account</a>
                  </div>
              </div>
            </div>
      </div>
        <div class="container-fluid container-xl position-relative d-flex align-items-center">
    
          <a href="index.html" class="logo d-flex align-items-center me-auto">
            
            <img src="assets/img/logo.png" alt="Logo Image">
          </a>
    
          <nav id="navmenu" class="navmenu">
            <ul>
              <li><a href="index.html" class="active">HOMEPAGE</a></li>
              <li><a href="about.html">ABOUT US</a></li>
              <li><a href="menu.html">MENU</a></li>
              <li><a href="meal-packages.html">MEAL PACKAGES</a></li>
              <li><a href="wishlist.html">WISHLIST</a></li>
              <li><a href="cart.html">MY CART</a></li>
              <li><a href="privacy-and-policy.html">PRIVACY & POLICY</a></li>
              <li><a href="contact.html">CONTACT US</a></li>
              <!-- <li class="dropdown"><a href="#"><span>Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                <ul>
                  <li><a href="#">Dropdown 1</a></li>
                  <li class="dropdown"><a href="#"><span>Deep Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                    <ul>
                      <li><a href="#">Deep Dropdown 1</a></li>
                      <li><a href="#">Deep Dropdown 2</a></li>
                      <li><a href="#">Deep Dropdown 3</a></li>
                      <li><a href="#">Deep Dropdown 4</a></li>
                      <li><a href="#">Deep Dropdown 5</a></li>
                    </ul>
                  </li>
                  <li><a href="#">Dropdown 2</a></li>
                  <li><a href="#">Dropdown 3</a></li>
                  <li><a href="#">Dropdown 4</a></li>
                </ul>
              </li> -->
            </ul>
            <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
          </nav>
    
          <!-- <a class="btn-getstarted" href="index.html#about">Get Started</a> -->
    
        </div>
      </header>
    
    <div class="top-section">
        <a href="index.html" class="back-button"><p class="back-button">Back</p></a>
        <h1 class="my-account-heading">MY ACCOUNT</h1>
    </div>
    <div class="row justify-content-center mb-5">
    <div class="col-md-8">
        <div class="tabs-container">
            <div class="tab-button" onclick="showSection('orders')">
                <img src="assets/img/ic-orders.png" alt="Order Icon" class="icon-size"/>
                Orders
            </div>
            <div class="tab-button" onclick="showSection('edit-account')">
                <img src="assets/img/ic-edit-account.png" alt="Edit Icon" class="icon-size"/>
                Edit Account
            </div>
            <div class="tab-button" onclick="showSection('address')">
                <img src="assets/img/ic-location.png" alt="Location Icon" class="icon-size"/>
                Address
            </div>
            <div class="tab-button" onclick="showSection('logout')">
                <img src="assets/img/ic-logout.png" alt="Logout Icon" class="icon-size"/>
                Logout
            </div>
        </div>
        <div class="container mt-5">
            <div id="orders" class="content-section active">
                <h4>All Orders:</h4>
                <div class="table">
                    <table id="orders-table" style="display: none; width: 100%;">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Total Amount</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table-body"></tbody>
                    </table>
                    
                    <p id="loading-message">Loading orders...</p>
                    <p id="error-message" style="display: none; color: red;">Failed to load orders.</p>
                </div>
                <h4>All Packages:</h4>
                <div class="table">
                    <table id="packages-table" style="display: none; width: 100%;">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Total Amount</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="packages-table-body"></tbody>
                    </table>
                    
                    <p id="loading-message">Loading orders...</p>
                    <p id="error-message" style="display: none; color: red;">Failed to load orders.</p>
                </div>
            </div>
            <div id="address" class="content-section text-center">
                 <form id="address-form">
                <div class="row mb-4 mb-2">
                    <label class="col-12 mb-2 label-text">Address Type</label>
                    <div class="col-md-6 mt-2">
                        <div class="card-address">
                            <label class="d-flex justify-content-between align-items-center" style="cursor: pointer;">
                                <!-- Left side: Icon and text -->
                                <div class="d-flex align-items-center">
                                    <img src="assets/img/home-icon-address.png" alt="Home Icon" class="mr-2" />
                                    <span>Home</span>
                                </div>
                                <!-- Right side: Radio button -->
                                <div>
                                    <input
                                        type="radio"
                                        name="address-type" 
                                        value="home"
                                        style="accent-color: #b6d63c"
                                    />
                                </div>
                            </label>
                        </div>
                    </div>
            
                    <div class="col-md-6 mt-2">
                        <div class="card-address">
                            <label class="d-flex justify-content-between align-items-center" style="cursor: pointer;">
                                <!-- Left side: Icon and text -->
                                <div class="d-flex align-items-center">
                                    <img src="assets/img/office-icon.png" alt="Office Icon" class="mr-2" />
                                    <span>Office</span>
                                </div>
                                <!-- Right side: Radio button -->
                                <div>
                                    <input
                                        type="radio"
                                        name="address-type"
                                        value="office"
                                        style="accent-color: #b6d63c"
                                    />
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            
                <div class="form-address mt-2 mb-2">
                    <label class="label-text">Area</label>
                </br>
                    <div class="d-flex align-items-center">
                        <input type="text" id="area" required />
                    </div>
                </div>
                <div class="form-address row mt-2 mb-2">
                    <div class="col-6">
                        <label class="label-text">Building</label>
                    </br>
                        <div class="d-flex align-items-center">
                            <input type="text" id="building" required />
                        </div>
                    </div>
                    <div class="col-6">
                        <label class="label-text">Flat</label><span class="optional-text"> (Optional)</span>
                    </br>
                        <div class="">
                            <input type="text" id="flat" />
                        </div>
                    </div>
                </div>
                <div class="form-address row mt-2 mb-2">
                    <div class="col-6">
                        <label class="label-text">City</label>
                    </br>
                        <div class="">
                            <input type="text" id="block" required />
                        </div>
                    </div>
                    <div class="col-6">
                        <label class="label-text">Country</label>
                    </br>
                        <div class="d-flex align-items-center">
                            <input type="text" id="street" required />
                        </div>
                    </div>
                </div>
                
                <!-- Error message for form submission -->
                <span id="form-error" class="text-danger small"></span>
                
                <div class="row mt-5">
                    <button type="button" class="btn btn-add-new center" id="buttonText" onclick="submitAddressForm()"> Save</button>
                </div>
            </form>
           <!-- Address List -->
        <div class="mt-4" id="address-list">
            <!-- Addresses will be loaded here dynamically -->
        </div>
              <!-- Popup Modal -->
              <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editModalLabel">Edit Address</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="edit-id">
                            <div class="mb-3">
                                <label for="edit-type" class="form-label">Type</label>
                                <input type="text" class="form-control" id="edit-type">
                            </div>
                            <div class="mb-3">
                                <label for="edit-area" class="form-label">Area</label>
                                <input type="text" class="form-control" id="edit-area">
                            </div>
                            <div class="mb-3">
                                <label for="edit-building" class="form-label">Building</label>
                                <input type="text" class="form-control" id="edit-building">
                            </div>
                            <div class="mb-3">
                                <label for="edit-block" class="form-label">City</label>
                                <input type="text" class="form-control" id="edit-block">
                            </div>
                            <div class="mb-3">
                                <label for="edit-street" class="form-label">Country</label>
                                <input type="text" class="form-control" id="edit-street">
                            </div>
                            <div class="mb-3">
                                <label for="edit-flat" class="form-label">Flat</label>
                                <input type="text" class="form-control" id="edit-flat">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" id="closeEditModal" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="updateAddress()">Update</button>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            <div id="-new-address" class="content-section">
                
            </div>
            <div id="edit-account" class="content-section">
                    <form>
                        <div class="mb-3">
                            <input type="text" class="form-control" id="register-username" placeholder="Username">
                        </div>                   
                        <div class="mb-3">
                            <input type="email" class="form-control" id="register-email" placeholder="Email">
                        </div>
                        <div class="mb-3">
                            <input type="text" class="form-control" id="register-number" placeholder="Number">
                        </div>
                        <button type="submit" class="btn btn-light-green">Save Changes</button>
                    </form>
            </div>
            <div id="logout" class="content-section">
                <p class="privacy-text">Are you sure you want to logout?</p>
                <div class="d-flex justify-content-center mt-3">
                    <button type="submit" class="btn btn-light-gray">No</button>
                    <button type="submit" class="btn btn-light-green">Yes</button>
                </div>
            </div>
            <!-- Toast container -->
          <div id="toast-container"
          style="position: fixed; bottom: 20px; right: 20px; z-index: 9999"
        ></div>
        </div>
    </div>
    </div>
     <!-- /Subscribe Footer Section --> 
  <!-- Footer will be loaded here -->
  <div id="footer-placeholder"></div>

  <!-- Address API Implementation here -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
        const addressForm = document.getElementById('address-form');

        if (!addressForm) {
            console.error('Address form not found');
            return;
        }

        addressForm.addEventListener('submit', function (e) {
            e.preventDefault(); // Prevent default form submission
            submitAddressForm(); // Call the form submission function
        });
    });

    function submitAddressForm() {
        const addressType = document.querySelector('input[name="address-type"]:checked')?.value;
        const area = document.getElementById('area')?.value.trim();
        const building = document.getElementById('building')?.value.trim();
        const flat = document.getElementById('flat')?.value.trim();
        const block = document.getElementById('block')?.value.trim();
        const street = document.getElementById('street')?.value.trim();

        // Retrieve token
        const token = localStorage.getItem("accessToken");

        if (!token) {
            showToast('You need to login first in order to update the address.', 'error');
            setTimeout(() => {
                window.location.href = 'auth.html'; // Redirect to login page
            }, 2000);
            return;
        }

        // Validate required fields
        if (!addressType || !area || !building || !block || !street) {
            showToast('Please fill out all required fields', 'error');
            return;
        }

        // Prepare the address data for API request
        const addressData = {
            type: addressType,
            area,
            building,
            block,
            street,
            flat: flat || "", // Optional field
        };

        // Define API base URL (Ensure this is set correctly)
        const apiUrl = `${apiBaseUrl}address`;

        axios
            .post(apiUrl, addressData, {
                headers: {
                    Authorization: `Bearer ${token}`,
                    'Content-Type': 'application/json',
                },
            })
            .then((response) => {
                console.log("Address submitted successfully:", response.data);
                showToast('Address saved successfully!', 'success');
            })
            .catch((error) => {
                console.error('Error submitting address:', error);

                let errorMessage = 'Error submitting address. Please try again.';
                if (error.response) {
                    if (error.response.data && error.response.data.message) {
                        errorMessage = `Address submission failed: ${error.response.data.message}`;
                    } else if (error.response.status === 401) {
                        errorMessage = 'Unauthorized: Please log in again.';
                        setTimeout(() => {
                            window.location.href = 'auth.html';
                        }, 2000);
                    }
                }

                showToast(errorMessage, 'error');
            });
    }

    // Toast notification function
    function showToast(message, type) {
        const toastContainer = document.getElementById('toast-container');
        if (!toastContainer) {
            console.error("Toast container not found");
            return;
        }

        // Remove existing toasts before adding a new one
        toastContainer.innerHTML = '';

        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerText = message;
        toastContainer.appendChild(toast);

        setTimeout(() => {
            toast.classList.add('show');
        }, 60);

        setTimeout(() => {
            toast.classList.remove('show');
            toast.addEventListener('transitionend', () => toast.remove());
        }, 4000);
    }
</script>
<!-- Address Show API Implementation here -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        fetchAddresses(); // Load addresses when the page loads
    });
    
    const apiUrl = `${apiBaseUrl}address`;
    
    function fetchAddresses() {
        const token = localStorage.getItem("accessToken");
        if (!token) {
            showToast('You need to login first to view addresses.', 'error');
            setTimeout(() => {
                window.location.href = 'auth.html'; // Redirect to login page
            }, 2000);
            return;
        }
    
        axios
            .get(apiUrl, {
                headers: {
                    Authorization: `Bearer ${token}`,
                    'Content-Type': 'application/json',
                },
            })
            .then(response => {
                console.log("API Response:", response.data); // Debugging output
                const addresses = response.data.data?.addresses || [];
                displayAddresses(addresses);
            })
            .catch(error => {
                console.error("Error fetching addresses:", error);
                showToast("Failed to load addresses. Please try again.", "error");
            });
    }
    
    function displayAddresses(addresses) {
        const addressContainer = document.querySelector('.mt-4');
        addressContainer.innerHTML = ''; // Clear previous content
    
        if (!addresses || addresses.length === 0) {
            addressContainer.innerHTML = '<p class="text-muted">No addresses found.</p>';
            return;
        }
    
        addresses.forEach(address => {
            const addressRow = document.createElement('div');
            addressRow.className = "row mt-3";
            addressRow.innerHTML = `
                <div class="col-8">
                    <div class="row align-items-start custom-row">
                        <div class="col-auto">
                            <span class="days-text">${address.type}</span>
                        </div>
                        <div class="col-auto">
                            <span class="days-text">${address.building} ${address.block}  ${address.street}</span>
                        </div>
                        <div class="col-auto">
                            <div>
                                <span class="days-text">${address.area}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-2">
                    <button class="btn btn-edit" onclick="editAddress('${address.id}')">Edit</button>
                </div>
                <div class="col-2">
                    <button class="btn btn-del" onclick="deleteAddress('${address.id}')">Delete</button>
                </div>
            `;
            addressContainer.appendChild(addressRow);
        });
    }
    
    function editAddress(addressId) {
    console.log("Editing address ID:", addressId);
    
    const token = localStorage.getItem("accessToken");
    if (!token) {
        showToast('Unauthorized. Please log in again.', 'error');
        return;
    }

    axios.get(`${apiUrl}/${addressId}`, {
        headers: {
            Authorization: `Bearer ${token}`,
            'Content-Type': 'application/json',
        },
    })
    .then(response => {
        // Ensure response structure is correctly handled
        const address = response.data.data?.address || {}; 
        console.log("Fetched Address Data:", address);

        // Assign values safely with fallback
        document.getElementById('edit-id').value = address.id || "";
        document.getElementById('edit-type').value = address.type || "";
        document.getElementById('edit-area').value = address.area || "";
        document.getElementById('edit-building').value = address.building || "";
        document.getElementById('edit-block').value = address.block || "";
        document.getElementById('edit-street').value = address.street || "";
        document.getElementById('edit-flat').value = address.flat || "";

        // Ensure Bootstrap modal is properly initialized before showing
        const modalElement = document.getElementById('editModal');
        const modalInstance = new bootstrap.Modal(modalElement);
        modalInstance.show();
    })
    .catch(error => {
        console.error("Error fetching address details:", error);
        showToast("Failed to fetch address details. Please try again.", "error");
    });
}
    
    function updateAddress() {
        const token = localStorage.getItem("accessToken");
        if (!token) {
            showToast('Unauthorized. Please log in again.', 'error');
            setTimeout(() => {
                window.location.href = 'auth.html';
            }, 2000);
            return;
        }
    
        // Get updated values
        const id = document.getElementById('edit-id').value;
        const updatedData = {
            type: document.getElementById('edit-type').value,
            area: document.getElementById('edit-area').value,
            building: document.getElementById('edit-building').value,
            block: document.getElementById('edit-block').value,
            street: document.getElementById('edit-street').value,
            flat: document.getElementById('edit-flat').value
        };
    
        axios
            .put(`${apiUrl}/${id}`, updatedData, {
                headers: {
                    Authorization: `Bearer ${token}`,
                    'Content-Type': 'application/json',
                },
            })
            .then(response => {
                showToast("Address updated successfully!", "success");
                fetchAddresses(); // Refresh the list
                document.getElementById('closeEditModal').click(); // Close modal
            })
            .catch(error => {
                console.error("Error updating address:", error);
                showToast("Failed to update address. Please try again.", "error");
            });
    }
    
    function deleteAddress(addressId) {
        const token = localStorage.getItem("accessToken");
        if (!token) {
            showToast('Unauthorized. Please log in again.', 'error');
            setTimeout(() => {
                window.location.href = 'auth.html';
            }, 2000);
            return;
        }
    
        if (!confirm("Are you sure you want to delete this address?")) {
            return;
        }
    
        axios
            .delete(`${apiUrl}/${addressId}`, {
                headers: {
                    Authorization: `Bearer ${token}`,
                    'Content-Type': 'application/json',
                },
            })
            .then(response => {
                showToast("Address deleted successfully!", "success");
                fetchAddresses(); // Refresh the list after deletion
            })
            .catch(error => {
                console.error("Error deleting address:", error);
                showToast("Failed to delete address. Please try again.", "error");
            });
    }
    </script>
<!-- Edit Account API Implementation here -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetchUserProfile();
    });

    const userApiUrl = `${apiBaseUrl}user`; // API URL

    function fetchUserProfile() {
        const token = localStorage.getItem("accessToken");
        if (!token) {
            showToast('You need to login first.', 'error');
            return setTimeout(() => window.location.href = 'auth.html', 2000);
        }

        axios.get(userApiUrl, {
            headers: { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' }
        })
        .then(response => {
            const user = response.data.data?.user || {};
            console.log("✅ Fetched User Data:", user);

            // Populate form fields
            document.getElementById('register-username').value = user.username || "";
            document.getElementById('register-email').value = user.email || "";
            document.getElementById('register-number').value = user.phone || "";

            // Email should not be editable
            document.getElementById('register-email').readOnly = true;
        })
        .catch(error => {
            console.error("❌ Error fetching profile:", error);
            showToast("Failed to load profile.", "error");
        });
    }

    function updateUserProfile(event) {
        event.preventDefault(); // Prevent default form submission

        const token = localStorage.getItem("accessToken");
        if (!token) {
            showToast('Unauthorized. Please log in again.', 'error');
            return;
        }

        // Get input values
        const updatedUsername = document.getElementById('register-username').value.trim();
        const updatedPhone = document.getElementById('register-number').value.trim() || null;

        const updatedData = {
            username: updatedUsername,
            phone: updatedPhone
        };

        console.log("📡 Sending Update Request:", updatedData); // Debug log

        axios.put(userApiUrl, updatedData, {
            headers: { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' }
        })
        .then(response => {
            console.log("✅ Update Response:", response.data);

            if (response.data.status === 200) {
                showToast("Profile updated successfully!", "success");

                // **Auto Reload Page After Update**
                setTimeout(() => {
                    location.reload(); // Reloads the page to reflect changes
                }, 1000);
            } else {
                showToast("Update failed. Try again!", "error");
            }
        })
        .catch(error => {
            console.error("❌ Error updating profile:", error.response?.data || error);
            showToast("Failed to update profile. Please try again.", "error");
        });
    }

    // Attach event listener to form
    document.querySelector('form').addEventListener('submit', updateUserProfile);
</script>

<!-- Get All Orders API Implementation here -->
<script>
    document.addEventListener("DOMContentLoaded", fetchOrders);

    async function fetchOrders() {
        const apiUrl = "https://api.voltfood.co/api/orders"; // Replace with correct API endpoint
        const token = localStorage.getItem("accessToken");

        if (!token) {
            console.error("❌ No access token found!");
            showError("You are not authorized. Please log in.");
            return;
        }

        try {
            console.log("📡 Fetching orders from:", apiUrl);

            const response = await fetch(apiUrl, {
                method: "GET",
                headers: {
                    "Authorization": `Bearer ${token}`,
                    "Content-Type": "application/json"
                }
            });

            const result = await response.json();
            console.log("📢 API Response:", result);

            if (response.ok && result.data.orders.length > 0) {
                populateOrdersTable(result.data.orders);
            } else {
                showError("No orders found.");
            }
        } catch (error) {
            console.error("🚨 Error fetching orders:", error);
            showError("Failed to load orders. Please try again.");
        }
    }

    function populateOrdersTable(orders) {
    const ordersTableBody = document.getElementById("orders-table-body");
    const ordersTable = document.getElementById("orders-table");
    const loadingMessage = document.getElementById("loading-message");
    const errorMessage = document.getElementById("error-message");

    if (!ordersTableBody || !ordersTable || !loadingMessage || !errorMessage) {
        console.error("🚨 Missing table elements in DOM.");
        return;
    }

    ordersTableBody.innerHTML = ""; // Clear previous entries

    orders.forEach(order => {
        console.log("🔹 Order Details:", order); // Debug log

        const totalAmount = order.total_amount || "N/A"; // Use total_amount instead
        const currency = order.currency || "SR"; // Use default currency if missing

        const row = document.createElement("tr");
        row.innerHTML = `
            <td><a href="#" class="order-id">#${order.id}</a></td>
            <td>${formatDate(order.createdAt)}</td>
            <td>${order.status}</td>
            <td><strong>${totalAmount} ${currency}</strong></td>
            <td>
                <a href="order-detail.html?order_id=${order.id}">
                    <button class="btn btn-view">View</button>
                </a>
            </td>
        `;
        ordersTableBody.appendChild(row);
    });

    ordersTable.style.display = "table";
    loadingMessage.style.display = "none";
    errorMessage.style.display = "none";
}

    function showError(message) {
        document.getElementById("loading-message").style.display = "none";
        const errorMessage = document.getElementById("error-message");
        errorMessage.innerText = message;
        errorMessage.style.display = "block";
    }

    function formatDate(dateString) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateString).toLocaleDateString(undefined, options);
    }
</script>

<!-- Get All Packages API Implementation here -->
<script>
    document.addEventListener("DOMContentLoaded", fetchPackages);

    async function fetchPackages() {
    const apiUrl = "https://api.voltfood.co/api/package-orders"; // Updated API endpoint
    const token = localStorage.getItem("accessToken");

    if (!token) {
        console.error("❌ No access token found!");
        showError("You are not authorized. Please log in.");
        return;
    }

    try {
        console.log("📡 Fetching package orders from:", apiUrl);

        const response = await fetch(apiUrl, {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
            }
        });

        const result = await response.json();
        console.log("📢 API Response:", result);

        // Fix: Access 'package_orders' instead of 'packages'
        if (response.ok && result.data.package_orders.length > 0) {
            populatePackagesTable(result.data.package_orders);
        } else {
            showError("No package orders found.");
        }
    } catch (error) {
        console.error("🚨 Error fetching package orders:", error);
        showError("Failed to load package orders. Please try again.");
    }
}

function populatePackagesTable(packages) {
    const packagesTableBody = document.getElementById("packages-table-body");
    const packagesTable = document.getElementById("packages-table");
    const loadingMessage = document.getElementById("loading-message");
    const errorMessage = document.getElementById("error-message");

    if (!packagesTableBody || !packagesTable || !loadingMessage || !errorMessage) {
        console.error("🚨 Missing table elements in DOM.");
        return;
    }

    packagesTableBody.innerHTML = ""; // Clear previous entries

    packages.forEach(pkg => {
        console.log("🔹 Package Details:", pkg); // Debug log

        const totalAmount = pkg.total_amount || "N/A"; // Use total_amount instead
        const currency = pkg.currency || "SR"; // Use default currency if missing

        const row = document.createElement("tr");
        row.innerHTML = `
            <td><a href="#" class="package-id">#${pkg.id}</a></td>
            <td>${formatDate(pkg.createdAt)}</td>
            <td>${pkg.status}</td>
            <td><strong>${totalAmount} ${currency}</strong></td>
            <td>
                <a href="package-detail.html?package_id=${pkg.id}">
                    <button class="btn btn-view">View</button>
                </a>
            </td>
        `;
        packagesTableBody.appendChild(row);
    });

    packagesTable.style.display = "table";
    loadingMessage.style.display = "none";
    errorMessage.style.display = "none";
}

function showError(message) {
    document.getElementById("loading-message").style.display = "none";
    const errorMessage = document.getElementById("error-message");
    errorMessage.innerText = message;
    errorMessage.style.display = "block";
}

function formatDate(dateString) {
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    return new Date(dateString).toLocaleDateString(undefined, options);
}
</script>




  <script>
    // Load footer.html into the placeholder div
    fetch("footer.html")
        .then(response => response.text())
        .then(data => {
            document.getElementById("footer-placeholder").innerHTML = data;
        })
        .catch(error => console.error("Error loading footer:", error));
</script>
    <script>
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }
    </script>
</body>
</html>
