<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Wishlist - Voltfood</title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon" />
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link
      href="assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
    <link
      href="assets/vendor/glightbox/css/glightbox.min.css"
      rel="stylesheet"
    />
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

    <!-- Main CSS File -->
    <link href="assets/css/main.css" rel="stylesheet" />
    <script src="assets/js/constant.js"></script>
    <!-- Add Axios CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- =======================================================
  * Template Name: eNno
  * Template URL: https://bootstrapmade.com/enno-free-simple-bootstrap-template/
  * Updated: Aug 07 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
  </head>

  <body class="index-page">
    <header id="header" class="header">
      <div class="container-fluid top-header">
        <div class="container-xl">
          <div class="row align-items-center">
            <div class="col-md-8 d-flex align-items-center">
              <nav id="navmenu" class="navmenu">
                <ul>
                  <li class="">
                    <img
                      src="assets/img/location-icon.png"
                      alt="Location Icon"
                      class="icon-right"
                    />
                    <span class="top-header-text"
                      >Address, Fox 99 Roving St, Big City PKU</span
                    >
                  </li>
                  <li class="">
                    <img
                      src="assets/img/email-icon.png"
                      alt="Email Icon"
                      class="icon-right"
                    />
                    <span class="top-header-text">hello@awesomesite.com</span>
                  </li>
                  <li class="">
                    <img
                      src="assets/img/phone-icon.png"
                      alt="Phone Icon"
                      class="icon-right"
                    />
                    <span class="top-header-text">+123-234-1234</span>
                  </li>
                </ul>
              </nav>
            </div>
            <div class="col-md-4 text-end">
              <a href="auth.html">Register</a>
              <a href="auth.html">Login</a>
              <a href="my-account.html">My Account</a>
            </div>
          </div>
        </div>
      </div>
      <div
        class="container-fluid container-xl position-relative d-flex align-items-center"
      >
        <a href="index.html" class="logo d-flex align-items-center me-auto">
          <img src="assets/img/logo.png" alt="Logo Image" />
        </a>

        <nav id="navmenu" class="navmenu">
          <ul>
            <li><a href="index.html" class="active">HOMEPAGE</a></li>
            <li><a href="about.html">ABOUT US</a></li>
            <li><a href="menu.html">MENU</a></li>
            <li><a href="meal-packages.html">MEAL PACKAGES</a></li>
            <li><a href="wishlist.html">WISHLIST</a></li>
            <li><a href="cart.html">MY CART</a></li>
            <li><a href="privacy-and-policy.html">PRIVACY & POLICY</a></li>
            <li><a href="contact.html">CONTACT US</a></li>
            <!-- <li class="dropdown"><a href="#"><span>Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="#">Dropdown 1</a></li>
              <li class="dropdown"><a href="#"><span>Deep Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                <ul>
                  <li><a href="#">Deep Dropdown 1</a></li>
                  <li><a href="#">Deep Dropdown 2</a></li>
                  <li><a href="#">Deep Dropdown 3</a></li>
                  <li><a href="#">Deep Dropdown 4</a></li>
                  <li><a href="#">Deep Dropdown 5</a></li>
                </ul>
              </li>
              <li><a href="#">Dropdown 2</a></li>
              <li><a href="#">Dropdown 3</a></li>
              <li><a href="#">Dropdown 4</a></li>
            </ul>
          </li> -->
          </ul>
          <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>

        <!-- <a class="btn-getstarted" href="index.html#about">Get Started</a> -->
      </div>
    </header>

    <main class="main">
      <!-- Wishlist Section -->
      <section
        id="testimonials"
        class="testimonials section light-background bg-image"
      >
        <div class="container mt-5">
          <h3>Wishlist</h3>
          <table class="table wishlist-table mt-4">
            <thead class="border-bottom">
              <tr>
                <th><input type="checkbox" id="select-all" /></th>
                <th></th>
                <th></th>
                <th>Product Name</th>
                <th>Unit Price</th>
                <th>Date Added</th>
                <th>Stock Status</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="wishlist-table-body">
              <!-- Wishlist items will be dynamically added here -->
            </tbody>
          </table>

          <!-- <div class="wishlist-actions d-flex justify-content-between">
                <select class="form-select w-25">
                    <option>Actions</option>
                </select>
                <div>
                    <button class="btn btn-cart">Apply Actions</button>
                    <button class="btn btn-cart" id="add-selected-to-cart">Add selection to Cart</button>
                    <button class="btn btn-cart" id="add-all-to-cart">Add all to Cart</button>
                </div>
            </div> -->
        </div>
      </section>
      <!-- /Wishlist Section -->
      <!-- Toast Container -->
      <div id="toast-container" class="toast-container"></div>
    </main>

    <script>
      const wishlistApiUrl = `${apiBaseUrl}wishlist`;
      // const removeWishlistApiUrl = `${apiBaseUrl}wishlist/remove`;
      // const cartApiUrl = `${apiBaseUrl}cart/add`;
      const token = localStorage.getItem("accessToken");

      // Function to show toast notifications
      function showToast(message, type = "success") {
        const toastContainer = document.getElementById("toast-container");
        if (!toastContainer) {
          console.error("Toast container not found!");
          return;
        }

        const toast = document.createElement("div");
        toast.className = `toast-message ${type}`;
        toast.innerHTML = message;

        toastContainer.appendChild(toast);

        setTimeout(() => {
          toast.remove();
        }, 3000);
      }

      // Function to fetch and display wishlist items
      async function fetchWishlist() {
        if (!token) {
          console.error("Access token not found!");
          return;
        }

        try {
          const response = await fetch(wishlistApiUrl, {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          const result = await response.json();

          if (
            response.ok &&
            result.status === 200 &&
            result.data.wishlist.length > 0
          ) {
            const wishlistTableBody = document.querySelector(
              ".wishlist-table tbody"
            );
            wishlistTableBody.innerHTML = "";

            result.data.wishlist.forEach((item) => {
              const product = item.product;

              const row = document.createElement("tr");
              row.innerHTML = `
                        <td><input type="checkbox" class="wishlist-checkbox" data-id="${
                          product.id
                        }"></td>
                        <td><span class="remove-btn" data-product-id="${
                          product.id
                        }">&times;</span></td>
                        <td> <img src="${imgBaseUrl}${
                product.productImage
              }"  alt="${product.title}"   style=""></td>
                        <td>${product.name}</td>
                        <td>${product.price}</td>
                        <td>${item.createdAt.split("T")[0]}</td>
                        <td>${
                          product.stock ? product.stock : "Out of Stock"
                        }</td>
                        <td><button class="btn btn-cart add-to-cart" data-product-id="${
                          product.id
                        }">Add to Cart</button></td>
                    `;

              wishlistTableBody.appendChild(row);
            });

            // Attach event listeners after content is loaded
            attachWishlistEventListeners();
          } else {
            document.querySelector(".wishlist-table tbody").innerHTML =
              "<tr><td colspan='8'>Your wishlist is empty.</td></tr>";
          }
        } catch (error) {
          console.error("Error fetching wishlist:", error);
          document.querySelector(".wishlist-table tbody").innerHTML =
            "<tr><td colspan='8'>Failed to load wishlist.</td></tr>";
        }
      }

      // Function to attach event listeners for remove and add-to-cart buttons
      function attachWishlistEventListeners() {
        document.querySelectorAll(".remove-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const productId = this.getAttribute("data-product-id");
            removeWishlistItem(productId);
          });
        });

        document.querySelectorAll(".add-to-cart").forEach((btn) => {
          btn.addEventListener("click", function () {
            const productId = this.getAttribute("data-product-id");
            addToCart(productId, 1);
          });
        });
      }

      // Function to remove an item from the wishlist
      async function removeWishlistItem(productId) {
        if (!token) {
          console.error("Access token not found!");
          return;
        }

        if (!productId) {
          console.error("Product ID is missing!");
          showToast("Product ID is missing.", "error");
          return;
        }

        try {
          const response = await fetch(removeWishlistApiUrl, {
            method: "POST",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ product_id: productId }),
          });

          const result = await response.json();

          if (response.ok && result.status === 200) {
            showToast("Item removed from wishlist!");
            fetchWishlist(); // Refresh wishlist
          } else {
            showToast(
              `Failed to remove item: ${result.message || "Unknown error"}`,
              "error"
            );
          }
        } catch (error) {
          console.error("Error removing wishlist item:", error);
          showToast("An error occurred while removing the item.", "error");
        }
      }

      // Function to add an item from wishlist to cart
      async function addToCart(productId, quantity) {
        if (!token) {
          console.error("Access token not found!");
          return;
        }

        if (!productId) {
          console.error("Product ID is missing!");
          showToast("Product ID is missing.", "error");
          return;
        }

        try {
          const response = await fetch(cartApiUrl, {
            method: "POST",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              product_id: productId,
              quantity: quantity.toString(), // Ensure quantity is sent
            }),
          });

          const result = await response.json();

          if (response.ok && result.status === 200) {
            showToast("Item added to cart successfully!");
            removeWishlistItem(productId); // Remove from wishlist after adding to cart
          } else {
            showToast(
              `Failed to add to cart: ${result.message || "Unknown error"}`,
              "error"
            );
          }
        } catch (error) {
          console.error("Error adding item to cart:", error);
          showToast(
            "An error occurred while adding the item to the cart.",
            "error"
          );
        }
      }

      // Load the wishlist when the page loads
      document.addEventListener("DOMContentLoaded", fetchWishlist);
    </script>

    <!-- /Subscribe Footer Section -->
    <!-- Footer will be loaded here -->
    <div id="footer-placeholder"></div>

    <script>
      // Load footer.html into the placeholder div
      fetch("footer.html")
        .then((response) => response.text())
        .then((data) => {
          document.getElementById("footer-placeholder").innerHTML = data;
        })
        .catch((error) => console.error("Error loading footer:", error));
    </script>

    <!-- Scroll Top -->
    <a
      href="#"
      id="scroll-top"
      class="scroll-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>

    <!-- Preloader -->
    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script>
      fetch("footer.html")
        .then((response) => response.text())
        .then(
          (data) =>
            (document.getElementById("footer-placeholder").innerHTML = data)
        )
        .catch((error) => console.error("Error loading the footer:", error));
    </script>

    <!-- Main JS File -->
    <script src="assets/js/main.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document
          .querySelectorAll(".quantity-control button")
          .forEach((button) => {
            button.addEventListener("click", function () {
              let input = this.parentElement.querySelector("input");
              let value = parseInt(input.value);
              if (this.classList.contains("increase")) {
                input.value = value + 1;
              } else if (this.classList.contains("decrease") && value > 1) {
                input.value = value - 1;
              }
            });
          });

        document.querySelectorAll(".remove-btn").forEach((button) => {
          button.addEventListener("click", function () {
            this.closest("tr").remove();
          });
        });
      });
    </script>
  </body>
</html>
